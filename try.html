<html>

<head>
    <script type="text/javascript" src="libraries/d3/d3.min.js"></script>

    <!-- d3 scale chromatic library -->
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <!-- d3 queue library to handle concurrent tasks -->
    <script src="https://d3js.org/d3-queue.v3.min.js"></script>


    <title> D3 Tutorial </title>

    <style>

			h1{ text-align:center; }

			rect{
				fill: lightblue;
				stroke: #999999;
				stroke-width: 2px;
			}

			circle {
				stroke: black;
				stroke-width: 2px;
				opacity: 0.6;
			}

			circle.yearpm {
				fill: DeepPink;
			}

			circle.yeartemp {
				fill: Blue;
			}
			circle.yearpress {
				fill: Green;
			}

			path.yearpress {
				fill: none;
				stroke: Green;
			}
			path.yearpm {
				fill: none;
				stroke: DeepPink;
			}

			path.yeartemp {
				fill: none;
				stroke: Blue;
			}

			svg{
				width: 100%;
				height: 100%;
			}


		</style>

</head>

<body>
<h1>Average Annual PM2.5 in Beijing from 2010 to 2014</h1>

<div id="myDiv">

</div>

<script>

			var dataPath = "PK.csv";


			d3.csv(dataPath, function(error,data){
				console.log(data);

				var myData = data;


				var pm2010 = new Array();
				var pm2011 = new Array();
				var pm2012 = new Array();
				var pm2013 = new Array();
				var pm2014 = new Array();

				var tem2010 = new Array();
				var tem2011 = new Array();
				var tem2012 = new Array();
				var tem2013 = new Array();
				var tem2014 = new Array();

				var press2010 = new Array();
				var press2011 = new Array();
				var press2012 = new Array();
				var press2013 = new Array();
				var press2014 = new Array();

				var dat2010 = new Array();
				for(var i = 0; i<myData.length; i ++) {
					if(data[i].year == "2010") {
						pm2010[i] = data[i].pm25
						tem2010[i] = data[i].TEMP
						press2010[i] = data[i].PRES
						dat2010[i] = data[i];
					} else if (data[i].year == "2011") {
						pm2011[i] = data[i].pm25
						tem2011[i] = data[i].TEMP
						press2011[i] = data[i].PRES
					} else if (data[i].year == "2012") {
						pm2012[i] = data[i].pm25
						tem2012[i] = data[i].TEMP
						press2012[i] = data[i].PRES
					} else if (data[i].year == "2013") {
						pm2013[i] = data[i].pm25
						tem2013[i] = data[i].TEMP
						press2013[i] = data[i].PRES
					} else {
						pm2014[i] = data[i].pm25
						tem2014[i] = data[i].TEMP
						press2014[i] = data[i].PRES
					}
				}


				var yearpm = new Array();
				var yeartemp = new Array();
				var yearpress = new Array();

				yearpm[0] = {"year": "2010", "count": d3.mean(pm2010).toFixed(2)};
				yearpm[1] = {"year": "2011", "count": d3.mean(pm2011).toFixed(2)};
				yearpm[2] = {"year": "2012", "count": d3.mean(pm2012).toFixed(2)};
				yearpm[3] = {"year": "2013", "count": d3.mean(pm2013).toFixed(2)};
				yearpm[4] = {"year": "2014", "count": d3.mean(pm2014).toFixed(2)};

				yeartemp[0] = {"year": "2010", "count": (d3.mean(tem2010) *8).toFixed(2)};
				yeartemp[1] = {"year": "2011", "count": (d3.mean(tem2011) *8).toFixed(2)};
				yeartemp[2] = {"year": "2012", "count": (d3.mean(tem2012) *8).toFixed(2)};
				yeartemp[3] = {"year": "2013", "count": (d3.mean(tem2013) *8).toFixed(2)};
				yeartemp[4] = {"year": "2014", "count": (d3.mean(tem2014) *8).toFixed(2)};

				yearpress[0] = {"year": "2010", "count": (d3.mean(press2010)/10).toFixed(2)};
				yearpress[1] = {"year": "2011", "count": (d3.mean(press2011)/10).toFixed(2)};
				yearpress[2] = {"year": "2012", "count": (d3.mean(press2012)/10).toFixed(2)};
				yearpress[3] = {"year": "2013", "count": (d3.mean(press2013)/10).toFixed(2)};
				yearpress[4] = {"year": "2014", "count": (d3.mean(press2014)/10).toFixed(2)};


				console.log(yearpm);
				console.log(yeartemp);
				console.log(yearpress);

                console.log(dat2010);
				<!----------------------------->

				<!-- viewport (dimensions) of the SVG that will contain the scatterplot -->
				var margin = 50;
				var width = 700;
				var height = 350;

				var count_extent = d3.extent(
					yearpm.concat(yeartemp),
					function (d) {
				        return d.count
                    }
				);

				console.log(count_extent);

				var  count_scale = d3.scaleLinear()
					.domain([90,115])
					.range([height,margin])

				var  time_extent = d3.extent(
					yearpm.concat(yeartemp),
					function (d) {
						return d.year
                    }
				);

				console.log(time_extent);


				var time_scale = d3.scaleTime()
					.domain(time_extent)
					.range([margin,width])

				var svgElement = d3.select("body")
					.append("svg")
					.attr("width",width+margin)
					.attr("height",height+margin);

				var line = d3.line()
					.x(function (d) {
						return time_scale(d.year);
                    })
					.y(function (d) {
						return count_scale(d.count);
                    })

  				var x_axis = d3.axisBottom(time_scale);

                var y_axis = d3.axisLeft(count_scale);

  				var scatterplot_SVG = d3.select("body")
                    .append("svg")
                    .attr("id","scatterplot")
                    .attr("width",width+margin)
                    .attr("height",height+margin);


                svgElement.append("path")
                    .attr("d",line(yearpm))
                    .attr("class","yearpm");

                svgElement.append("path")
                    .attr("d",line(yeartemp))
                    .attr("class","yeartemp");

 				svgElement.append("path")
                    .attr("d",line(yearpress))
                    .attr("class","yearpress");

				svgElement.selectAll("circle.yearpress")
					.data(yearpress)
					.enter()
					.append("circle")
					.attr("class","yearpress");

				svgElement.selectAll("circle.yearpm")
					.data(yearpm)
					.enter()
					.append("circle")
					.attr("class","yearpm");

				svgElement.selectAll("circle.yeartemp")
					.data(yeartemp)
					.enter()
					.append("circle")
					.attr("class","yeartemp")

				d3.selectAll("circle")
					.attr("cy",function (d) {
					    return count_scale(d.count);

                    })
					.attr("cx",function (d) {
						return time_scale(d.year)
                    })
					.attr("r",5)

                    .on("click",function(d,i) {
					    d3.select(this)
							.transition()
							.style("fill","red");
					})

			     svgElement.append("g")
                    .attr("class","x axis")
                    .attr("transform","translate(0," + (height) + ")")
                    .call(x_axis);

                svgElement.append("g")
                    .attr("class","y axis")
                    .attr("transform","translate(" + margin + ",0)")
                    .call(y_axis)


                d3.select(".x.axis")
                    .append("text")
                    .text("Year")
                    .style("fill","black")
                    .attr("x",((width-margin)/2) + margin)
                    .attr("y",margin)

                d3.select(".y.axis")
                    .append("text")
                    .text("Values")
                    .style("fill","black")
                    .attr("transform","rotate(-90,0," + (margin-10) + ")translate (" + (-margin) + ",0)")


			svgElement.append("g")
				.selectAll("text")
				.data(yearpress)
				.enter()
				.append("text")
					.attr("x",710)
					.attr("y",215)
					.text("Pressure *");

               svgElement.append("g")
				.selectAll("text")
				.data(yearpm)
				.enter()
				.append("text")
					.attr("x",710)
					.attr("y",120)
					.text("PM 2.5");

               	svgElement.append("g")
				.selectAll("text")
				.data(yeartemp)
				.enter()
				.append("text")
					.attr("x",710)
					.attr("y",265)
					.text("Temperature *");

               svgElement.append("g")
				.selectAll("text")
				.data(yeartemp)
				.enter()
				.append("text")
					.attr("x",40)
					.attr("y",450)
					.text("* Pressure: Average Atmospheric pressure. Values are divided by 10 ");

				svgElement.append("g")
				.selectAll("text")
				.data(yeartemp)
				.enter()
				.append("text")
					.attr("x",40)
					.attr("y",480)
					.text("* Temperature: Average centigrade temperature multiplied by 8");

				svgElement.append("g")
				.selectAll("text")
				.data(yeartemp)
				.enter()
				.append("text")
					.attr("x",900)
					.attr("y",450)
					.style("fill","orange")
					.text("Average PM2.5 Annually");

				svgElement.append("g")
				.selectAll("text")
				.data(yeartemp)
				.enter()
				.append("text")
					.attr("x",880)
					.attr("y",480)
					.style("fill","orange")
					.text("Roll Over to See PM 2.5 Value");

				svgElement.append("g")
				.selectAll("text")
				.data(yeartemp)
				.enter()
				.append("text")
					.attr("x",100)
					.attr("y",50)
					.style("fill","gold")
					.text("Click Scatters to Mark");


				<!-- -------------------------------------------------------------->
				var updateButton1 = svgElement.append("g")
										.attr("class", "Enter 2010")
										.on("click", function(d){
											console.log("hello update");
											update(dat2010);
										});

				updateButton1.append("rect")
								.style("fill","lightgrey")
								.attr("width", 85)
								.attr("height", 22)
								.attr("x",940)
								.attr("y",52);
				updateButton1.append("text")
								.text("Enter 2010")
								.attr("x", "941")
								.attr("y", "70");

			var barWidth = 20;
			var margin_bars = 10;;
			var chartHeight = 400;
            var pm25NW = 0;
            var pm25SE = 0 ;
            var pm25CV = 0
            var pm25NE = 0;

					function update(dat)
			{
				  svgElement.remove();
				  var windpm = new Array();

				  for(var j = 0; j<dat.length; j++) {
				    if(dat[j].cbwd == "NW") {
				        pm25NW = pm25NW + parseFloat(dat[j].pm25)
				     } else if (dat[j].cbwd == "SE") {
				        pm25SE = pm25SE + parseFloat(dat[j].pm25)
				     } else if (dat[j].cbwd == "cv"){
				        pm25CV = pm25CV + parseFloat(dat[j].pm25)
				     } else {
				        pm25NE = pm25NE + parseFloat(dat[j].pm25)
				     }
				  }



		        windpm[0] = {"wind": "NW", "count":  (pm25NW/1000).toFixed(2)}
		        windpm[1] = {"wind": "SE", "count":  (pm25SE/1000).toFixed(2)}
		        windpm[2] = {"wind": "CV", "count":  (pm25CV/1000).toFixed(2)}
		        windpm[3] = {"wind": "NE", "count":  (pm25NE/1000).toFixed(2)}
                <!--console.log(pm25NW);-->
                <!--console.log(pm25NE);-->
                <!--console.log(pm25SE);-->


                  d3.select("svg")
					.selectAll("rect")
					.data(windpm)
					.enter()
					.append("rect")
					    .style("fill","gold")
						.attr("width",function (d) {
							return d.count ;
                        })
						.attr("height",20)
						.attr("x",20)
						.attr("y",function (d,i) {
					   	 return i*50 + 80;
                  	  })

                    .on("mouseenter",function(d,i) {
					    d3.select(this)
							.transition()
							.duration(200)
							.style("fill","green");
					    console.log(d);

				    d3.select("svg")
							.append("text")
							.attr("class","tooltip")
							.attr("x",400)
							.style("fill","green")
							.attr("y",(i*50)+95)
							.text("	 PM2.5 :" + d.count);

					})

					.on("mouseout",function (d) {
						d3.select(this)
							.transition()
							.duration(300)
							.style("fill","gold")
                    })

		    	<!--attach the labels-->
		        d3.select("svg")
			        	.selectAll("text")
			        	.data(windpm)
			        	.enter()
			        	.append("text")
				        	.attr("x",20)
				        	.attr("y",function (d,i) {
					        	return i*50+70;
               	        	 })
				        	.text(function (d) {
					        	return ("Wind Direction: " + d.wind);
               	        	 });

                console.log(windpm);
            }

			<!--------------------------------->
				svgElement.append("g")
					.selectAll("rect")
					.data(yearpm)
					.enter()
					.append("rect")
						.attr("width",function (d) {
							return (d.count - 80) *12;
                        })
						.attr("height",20)
						.attr("x",850)
						.attr("y",function (d,i) {
					   	 return i*70 + 80;
                  	  })


					.on("mouseenter",function(d,i) {
					    d3.select(this)
							.transition()
							.duration(200)
							.style("fill","pink");
					    console.log(d);

				    svgElement.append("g")
							.append("text")
							.attr("class","tooltip")
							.attr("x",50+1120)
							.style("fill","green")
							.attr("y",(i*70+95))
							.text("	 PM2.5 :" + d.count);

					})

					.on("mouseout",function (d) {
						d3.select(this)
							.transition()
							.duration(300)
							.style("fill","lightblue")
                    })


			<!--attach the labels-->
			svgElement.append("g")
				.selectAll("text")
				.data(yearpm)
				.enter()
				.append("text")
					.attr("x",850)
					.attr("y",function (d,i) {
						return i*70+70;
               		 })
					.text(function (d) {
						return ("Year: " + d.year);
               		 });


			<!--------------------------------->

		});

		</script>
<a style="margin-left:600" href="visualization.html" class="button">Reset</a>


</body>

</html>